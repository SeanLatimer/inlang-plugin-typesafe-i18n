var h=async(e,t,n=0)=>{let r=await e.readdir(t,{withFileTypes:!0}),a=r.filter(i=>!i.isDirectory()).map(({name:i})=>({name:i.toString(),folder:""})),s=r.filter(i=>i.isDirectory());if(n)for(let i of s)a.push(...(await h(e,`${t}/${i.name}/`,n-1)).map(o=>({name:o.name.toString(),folder:i.name.toString()})));return a},k=async(e,t,n)=>{let r=n==="JavaScript"?".js":".ts";return(await h(e,t,1)).filter(({folder:s,name:i})=>s&&i===`index${r}`).map(({folder:s})=>s)},E=async e=>({baseLocale:"en",tempPath:"./node_modules/typesafe-i18n/temp-output/",outputPath:"./src/i18n/",outputFormat:"TypeScript",typesFileName:"i18n-types",utilFileName:"i18n-util",formattersTemplateFileName:"formatters",typesTemplateFileName:"custom-types",esmImports:!1,adapter:void 0,generateOnlyTypes:!1,banner:"/* eslint-disable */",runAfterGenerator:void 0,...e}),I=async e=>{let t=await e.readFile(".typesafe-i18n.json").catch(()=>"{}");return JSON.parse(t.toString())},f=async e=>{let t=await I(e);return E(t)},v=async e=>{let t=await f(e);return{base:t.baseLocale,locales:await k(e,t.outputPath,t.outputFormat)}};function d(e){return t=>n=>e({settings:t,env:n})}var w=e=>e!==void 0,j=e=>typeof e=="string",C=e=>t=>t[e],S=e=>Array.from(new Set(e)),F=e=>Object.fromEntries(Object.entries(e).map(([t,n])=>t!=="i"&&n&&n!="0"&&[t,n]).filter(Boolean)),O=e=>Object.fromEntries(Object.keys(e).map(t=>{let n=e[t];return[t,Array.isArray(n)?n.map(r=>r?.trim()):n===!!n?n:n?.trim()]})),z=e=>{let[t="",...n]=e.split("|"),[r="",a]=t.split(":"),[s,i]=r.split("?");return{k:s,i:a,n:i==="",f:n}},M=e=>!!(e.o||e.r),A=(e,t)=>{let[n,r]=e.split(":");r||(r=n,n=t);let a=r.split("|"),[s,i,o,l,c,u]=a,g=a.filter(R=>R!==void 0).length;return g===1?{k:n,r:s}:g===2?{k:n,o:s,r:i}:g===3?{k:n,z:s,o:i,r:o}:{k:n,z:s,o:i,t:o,f:l,m:c,r:u}},W=/^\{.*\}$/,L=e=>Object.fromEntries(y(e).split(",").map(t=>t.split(":")).reduce((t,n)=>n.length===2?[...t,n.map(r=>r.trim())]:(t[t.length-1][1]+=","+n[0],t),[])),P=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,y=e=>e.substring(1,e.length-1),_=(e,t=!0,n="",r="")=>e.split(P).map(a=>{if(!a.match(P))return a;let s=y(a);if(s.startsWith("{"))return A(y(s),r);let i=z(s);return r=i.k||r,!n&&(n=r),i}).map(a=>{if(typeof a=="string")return a;a.k||(a.k=n||"0");let s=O(a);return t?F(s):s});var B=e=>e.kind==="plural",D=e=>e.kind==="parameter",N=e=>e.kind==="switch-case",b=e=>q(_(e,!1).map(V).filter(w)),V=e=>j(e)?e?G(e):void 0:M(e)?J(e):U(e),G=e=>({kind:"text",content:e}),J=({k:e,z:t,o:n,t:r,f:a,m:s,r:i})=>({kind:"plural",key:e,...t?{zero:t}:void 0,...n?{one:n}:void 0,...r?{two:r}:void 0,...a?{few:a}:void 0,...s?{many:s}:void 0,other:i}),U=({k:e,i:t,n,f:r})=>({kind:"parameter",key:e,types:t?[t]:[],optional:n||!1,transforms:(r||[]).map(X)}),X=e=>e.match(W)?{kind:"switch-case",cases:Object.entries(L(e)).map(([n,r])=>({key:n,value:r})),raw:e}:{kind:"formatter",name:e},q=e=>{let t=e.filter(D),n=e.filter(B),r={};return t.forEach(({key:a,types:s,transforms:i,optional:o})=>{var l,c;let u=s.length?s:H(i);r[a]={types:S([...((l=r[a])==null?void 0:l.types)||[],...u]).filter(w),optional:((c=r[a])==null?void 0:c.optional)||o}}),n.forEach(({key:a})=>{var s;(s=r[a])!=null&&s.types.length||(r[a]={types:["string","number","boolean"],optional:!1})}),Object.keys(r).forEach(a=>{var s,i;(s=r[a])!=null&&s.types.length||(r[a]={types:["unknown"],optional:((i=r[a])==null?void 0:i.optional)||!1})}),Object.entries(r).forEach(([a,s])=>{let i=t.find(o=>o.key===a);i&&(i.types=s.types,i.optional=i.optional||s.optional)}),e},H=e=>{if(!e?.length)return[];let t=e[0];return N(t)?t.cases.map(C("key")).map(r=>r==="*"?"string":`'${r}'`):[]};var p=e=>({...e,readdir:async(t,n)=>{let r=await e.readdir(t);return n?.withFileTypes?r.map(a=>({name:a,isDirectory:()=>!(a.endsWith(".ts")||a.endsWith(".js"))})):r}}),m=(...e)=>e.map(t=>{for(;t.startsWith("/");)t=t.substring(1);for(;t.endsWith("/");)t=t.substring(0,t.length-1);return t}).join("/");async function $({config:e,$fs:t}){let n=p(t),r=await f(n),a=[];for(let s of e.languages){let i=await Q(n,r.outputPath,s);a.push(Y(i,s))}return a}var Q=async(e,t,n)=>{let i=(await e.readFile(m(t,`${n}/index.ts`),{encoding:"utf-8"})).split(`
`).filter(l=>!l.trim().startsWith("import ")).join(`
`).replace(/const\s\w[^\s]+\s*(:\s*\w[^\s]+\s*)=/g,(l,c)=>l.replace(c,"")).replace(/ satisfies.*\/n/g,`
`);return(await import("data:application/javascript,"+encodeURIComponent(i))).default},Y=(e,t)=>({type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([n,r])=>x(n,r)).flat()}),x=(e,t)=>{if(typeof t=="object")return Object.entries(t).map(([r,a])=>x(`${e}.${r}`,a)).flat();let n=b(t);return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:n.map(r=>{switch(r.kind){case"parameter":return Z(r);case"text":return{type:"Text",value:r.content};case"plural":return K(r)}})}}},Z=e=>({type:"Placeholder",body:{type:"VariableReference",name:e.key,metadata:{types:e.types,optional:e.optional,transforms:e.transforms}}}),K=e=>({type:"Text",value:`{{${[e.zero,e.one,e.two,e.few,e.many,e.other].filter(Boolean).join("|")}}}`});async function T({$fs:e,config:t,resources:n}){let r=p(e),a=await f(r);for(let s of n){let i=s.languageTag.name,o=i===t.referenceLanguage,l=ee(s,o),c=o?"BaseTranslation":"Translation",u=`import type { ${c} } from '../${a.typesFileName}'
const ${i}: ${c} = ${l}

export default ${i}`;await r.writeFile(m(a.outputPath,`${i}/index.ts`),u)}}var ee=(e,t)=>{let n={};return e.body.map(r=>te(r,t)).forEach(([r,a])=>{let s=r.split("."),i=n;for(let o=0;o<s.length;o++){let l=s[o];o===s.length-1?i[l]=a:(i[l]||(i[l]={}),i=i[l])}}),JSON.stringify(n,null,3)},te=(e,t)=>[e.id.name,re(e.pattern,t)],re=(e,t)=>e.elements.map(n=>ne(n,t)).join(""),ne=(e,t)=>{switch(e.type){case"Text":return e.value;case"Placeholder":return ae(e,t)}},ae=({body:{name:e,metadata:t={}}},n)=>{let r=e;return n&&(t.optional&&(r+="?"),t.types?.length>0&&(t.types.length===3&&t.types.includes("string")&&t.types.includes("number")&&t.types.includes("boolean")||(r+=`:${t.types[0]}`))),t.transforms?.length>0&&(r+=`|${t.transforms.map(({name:a})=>a).join("|")}`),`{${r}}`};var ie=d(({env:e})=>({id:"ivanhofer.inlang-plugin-typesafe-i18n",async config(){let{base:t,locales:n}=await v(p(e.$fs));return{referenceLanguage:t,languages:n,readResources:({config:r})=>$({config:r,...e}),writeResources:({config:r,resources:a})=>T({config:r,resources:a,...e})}}}));export{ie as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
//# sourceMappingURL=index.js.map
