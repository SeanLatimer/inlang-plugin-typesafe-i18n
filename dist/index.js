var h=async(e,t,n=0)=>{let r=await e.readdir(t,{withFileTypes:!0}),i=r.filter(a=>!a.isDirectory()).map(({name:a})=>({name:a.toString(),folder:""})),s=r.filter(a=>a.isDirectory());if(n)for(let a of s)i.push(...(await h(e,`${t}/${a.name}/`,n-1)).map(o=>({name:o.name.toString(),folder:a.name.toString()})));return i},k=async(e,t,n)=>{let r=n==="JavaScript"?".js":".ts";return(await h(e,t,1)).filter(({folder:s,name:a})=>s&&a===`index${r}`).map(({folder:s})=>s)},E=async e=>({baseLocale:"en",tempPath:"./node_modules/typesafe-i18n/temp-output/",outputPath:"./src/i18n/",outputFormat:"TypeScript",typesFileName:"i18n-types",utilFileName:"i18n-util",formattersTemplateFileName:"formatters",typesTemplateFileName:"custom-types",esmImports:!1,adapter:void 0,generateOnlyTypes:!1,banner:"/* eslint-disable */",runAfterGenerator:void 0,...e}),I=async e=>{let t=await e.readFile(".typesafe-i18n.json").catch(()=>"{}");return JSON.parse(t.toString())},f=async e=>{let t=await I(e);return E(t)},v=async e=>{let t=await f(e);return{base:t.baseLocale,locales:await k(e,t.outputPath,t.outputFormat)}};function d(e){return t=>n=>e({settings:t,env:n})}var w=e=>e!==void 0,j=e=>typeof e=="string",C=e=>t=>t[e],S=e=>Array.from(new Set(e)),F=e=>Object.fromEntries(Object.entries(e).map(([t,n])=>t!=="i"&&n&&n!="0"&&[t,n]).filter(Boolean)),O=e=>Object.fromEntries(Object.keys(e).map(t=>{let n=e[t];return[t,Array.isArray(n)?n.map(r=>r?.trim()):n===!!n?n:n?.trim()]})),z=e=>{let[t="",...n]=e.split("|"),[r="",i]=t.split(":"),[s,a]=r.split("?");return{k:s,i,n:a==="",f:n}},M=e=>!!(e.o||e.r),A=(e,t)=>{let[n,r]=e.split(":");r||(r=n,n=t);let i=r.split("|"),[s,a,o,l,c,u]=i,g=i.filter(R=>R!==void 0).length;return g===1?{k:n,r:s}:g===2?{k:n,o:s,r:a}:g===3?{k:n,z:s,o:a,r:o}:{k:n,z:s,o:a,t:o,f:l,m:c,r:u}},W=/^\{.*\}$/,L=e=>Object.fromEntries(y(e).split(",").map(t=>t.split(":")).reduce((t,n)=>n.length===2?[...t,n.map(r=>r.trim())]:(t[t.length-1][1]+=","+n[0],t),[])),P=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,y=e=>e.substring(1,e.length-1),_=(e,t=!0,n="",r="")=>e.split(P).map(i=>{if(!i.match(P))return i;let s=y(i);if(s.startsWith("{"))return A(y(s),r);let a=z(s);return r=a.k||r,!n&&(n=r),a}).map(i=>{if(typeof i=="string")return i;i.k||(i.k=n||"0");let s=O(i);return t?F(s):s});var B=e=>e.kind==="plural",D=e=>e.kind==="parameter",N=e=>e.kind==="switch-case",b=e=>q(_(e,!1).map(V).filter(w)),V=e=>j(e)?e?G(e):void 0:M(e)?J(e):U(e),G=e=>({kind:"text",content:e}),J=({k:e,z:t,o:n,t:r,f:i,m:s,r:a})=>({kind:"plural",key:e,...t?{zero:t}:void 0,...n?{one:n}:void 0,...r?{two:r}:void 0,...i?{few:i}:void 0,...s?{many:s}:void 0,other:a}),U=({k:e,i:t,n,f:r})=>({kind:"parameter",key:e,types:t?[t]:[],optional:n||!1,transforms:(r||[]).map(X)}),X=e=>e.match(W)?{kind:"switch-case",cases:Object.entries(L(e)).map(([n,r])=>({key:n,value:r})),raw:e}:{kind:"formatter",name:e},q=e=>{let t=e.filter(D),n=e.filter(B),r={};return t.forEach(({key:i,types:s,transforms:a,optional:o})=>{var l,c;let u=s.length?s:H(a);r[i]={types:S([...((l=r[i])==null?void 0:l.types)||[],...u]).filter(w),optional:((c=r[i])==null?void 0:c.optional)||o}}),n.forEach(({key:i})=>{var s;(s=r[i])!=null&&s.types.length||(r[i]={types:["string","number","boolean"],optional:!1})}),Object.keys(r).forEach(i=>{var s,a;(s=r[i])!=null&&s.types.length||(r[i]={types:["unknown"],optional:((a=r[i])==null?void 0:a.optional)||!1})}),Object.entries(r).forEach(([i,s])=>{let a=t.find(o=>o.key===i);a&&(a.types=s.types,a.optional=a.optional||s.optional)}),e},H=e=>{if(!e?.length)return[];let t=e[0];return N(t)?t.cases.map(C("key")).map(r=>r==="*"?"string":`'${r}'`):[]};var p=e=>({...e,readdir:async(t,n)=>{let r=await e.readdir(t);return n?.withFileTypes?r.map(i=>({name:i,isDirectory:()=>!(i.endsWith(".ts")||i.endsWith(".js"))})):r}}),m=(...e)=>e.map(t=>{for(;t.startsWith("/");)t=t.substring(1);for(;t.endsWith("/");)t=t.substring(0,t.length-1);return t}).join("/");async function $({config:e,$fs:t}){let n=p(t),r=await f(n),i=[];for(let s of e.languages){let a=await Q(n,r.outputPath,s);i.push(Y(a,s))}return i}var Q=async(e,t,n)=>{let a=(await e.readFile(m(t,`${n}/index.ts`),{encoding:"utf-8"})).toString().split(`
`).filter(l=>!l.trim().startsWith("import ")).join(`
`).replace(/:.*=/g," =").replace(/ satisfies.*\/n/g,`
`);return(await import("data:application/javascript,"+encodeURIComponent(a))).default},Y=(e,t)=>({type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([n,r])=>x(n,r)).flat()}),x=(e,t)=>{if(typeof t=="object")return Object.entries(t).map(([r,i])=>x(`${e}.${r}`,i)).flat();let n=b(t);return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:n.map(r=>{switch(r.kind){case"parameter":return Z(r);case"text":return{type:"Text",value:r.content};case"plural":return K(r)}})}}},Z=e=>({type:"Placeholder",body:{type:"VariableReference",name:e.key,metadata:{types:e.types,optional:e.optional,transforms:e.transforms}}}),K=e=>({type:"Text",value:`{{${[e.zero,e.one,e.two,e.few,e.many,e.other].filter(Boolean).join("|")}}}`});async function T({$fs:e,config:t,resources:n}){let r=p(e),i=await f(r);for(let s of n){let a=s.languageTag.name,o=a===t.referenceLanguage,l=ee(s,o),c=o?"BaseTranslation":"Translation",u=`import type { ${c} } from '../${i.typesFileName}'
const ${a}: ${c} = ${l}

export default ${a}`;await r.writeFile(m(i.outputPath,`${a}/index.ts`),u)}}var ee=(e,t)=>{let n={};return e.body.map(r=>te(r,t)).forEach(([r,i])=>{let s=r.split("."),a=n;for(let o=0;o<s.length;o++){let l=s[o];o===s.length-1?a[l]=i:(a[l]||(a[l]={}),a=a[l])}}),JSON.stringify(n,null,3)},te=(e,t)=>[e.id.name,re(e.pattern,t)],re=(e,t)=>e.elements.map(n=>ne(n,t)).join(""),ne=(e,t)=>{switch(e.type){case"Text":return e.value;case"Placeholder":return ie(e,t)}},ie=({body:{name:e,metadata:t={}}},n)=>{let r=e;return n&&(t.optional&&(r+="?"),t.types?.length>0&&(t.types.length===3&&t.types.includes("string")&&t.types.includes("number")&&t.types.includes("boolean")||(r+=`:${t.types[0]}`))),t.transforms?.length>0&&(r+=`|${t.transforms.map(({name:i})=>i).join("|")}`),`{${r}}`};var ae=d(({env:e})=>({id:"ivanhofer.inlang-plugin-typesafe-i18n",async config(){let{base:t,locales:n}=await v(p(e.$fs));return{referenceLanguage:t,languages:n,readResources:({config:r})=>$({config:r,...e}),writeResources:({config:r,resources:i})=>T({config:r,resources:i,...e})}}}));export{ae as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
//# sourceMappingURL=index.js.map
